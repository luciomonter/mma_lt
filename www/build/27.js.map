<<<<<<< HEAD
{"version":3,"sources":["../../src/core/login/pages/site-policy/site-policy.module.ts","../../src/core/login/pages/site-policy/site-policy.ts"],"names":[],"mappings":"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","file":"27.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { CoreLoginSitePolicyPage } from './site-policy';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { CoreComponentsModule } from '@components/components.module';\r\nimport { CoreDirectivesModule } from '@directives/directives.module';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        CoreLoginSitePolicyPage\r\n    ],\r\n    imports: [\r\n        CoreComponentsModule,\r\n        CoreDirectivesModule,\r\n        IonicPageModule.forChild(CoreLoginSitePolicyPage),\r\n        TranslateModule.forChild()\r\n    ]\r\n})\r\nexport class CoreLoginSitePolicyPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/login/pages/site-policy/site-policy.module.ts","// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\r\nimport { CoreSitesProvider } from '@providers/sites';\r\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\r\nimport { CoreMimetypeUtilsProvider } from '@providers/utils/mimetype';\r\nimport { CoreUtilsProvider } from '@providers/utils/utils';\r\nimport { CoreLoginHelperProvider } from '../../providers/helper';\r\nimport { CoreSite } from '@classes/site';\r\n\r\n/**\r\n * Page to accept a site policy.\r\n */\r\n@IonicPage({ segment: 'core-login-site-policy' })\r\n@Component({\r\n    selector: 'page-core-login-site-policy',\r\n    templateUrl: 'site-policy.html',\r\n})\r\nexport class CoreLoginSitePolicyPage {\r\n    sitePolicy: string;\r\n    showInline: boolean;\r\n    policyLoaded: boolean;\r\n    protected siteId: string;\r\n    protected currentSite: CoreSite;\r\n\r\n    constructor(private navCtrl: NavController, navParams: NavParams, private loginHelper: CoreLoginHelperProvider,\r\n            private domUtils: CoreDomUtilsProvider, private sitesProvider: CoreSitesProvider, private utils: CoreUtilsProvider,\r\n            private mimeUtils: CoreMimetypeUtilsProvider) {\r\n        this.siteId = navParams.get('siteId');\r\n    }\r\n\r\n    /**\r\n     * View laoded.\r\n     */\r\n    ionViewDidLoad(): void {\r\n        this.currentSite = this.sitesProvider.getCurrentSite();\r\n\r\n        if (!this.currentSite) {\r\n            // Not logged in, stop.\r\n            this.cancel();\r\n\r\n            return;\r\n        }\r\n\r\n        const currentSiteId = this.currentSite.id;\r\n        this.siteId = this.siteId || currentSiteId;\r\n\r\n        if (this.siteId != currentSiteId || !this.currentSite.wsAvailable('core_user_agree_site_policy')) {\r\n            // Not current site or WS not available, stop.\r\n            this.cancel();\r\n\r\n            return;\r\n        }\r\n\r\n        this.fetchSitePolicy();\r\n    }\r\n\r\n    /**\r\n     * Fetch the site policy URL.\r\n     *\r\n     * @return {Promise<any>} Promise resolved when done.\r\n     */\r\n    protected fetchSitePolicy(): Promise<any> {\r\n        return this.loginHelper.getSitePolicy(this.siteId).then((sitePolicy) => {\r\n            this.sitePolicy = sitePolicy;\r\n\r\n            // Try to get the mime type.\r\n            return this.utils.getMimeTypeFromUrl(sitePolicy).then((mimeType) => {\r\n                const extension = this.mimeUtils.getExtension(mimeType, sitePolicy);\r\n                this.showInline = extension == 'html' || extension == 'htm';\r\n            }).catch(() => {\r\n                // Unable to get mime type, assume it's not supported.\r\n                this.showInline = false;\r\n            }).finally(() => {\r\n                this.policyLoaded = true;\r\n            });\r\n        }).catch((error) => {\r\n            this.domUtils.showErrorModalDefault(error && error.error, 'Error getting site policy.');\r\n            this.cancel();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Cancel.\r\n     */\r\n    cancel(): void {\r\n        this.sitesProvider.logout().catch(() => {\r\n            // Ignore errors, shouldn't happen.\r\n        }).then(() => {\r\n            this.navCtrl.setRoot('CoreLoginSitesPage');\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Accept the site policy.\r\n     */\r\n    accept(): void {\r\n        const modal = this.domUtils.showModalLoading('core.sending', true);\r\n        this.loginHelper.acceptSitePolicy(this.siteId).then(() => {\r\n            // Success accepting, go to site initial page.\r\n            // Invalidate cache since some WS don't return error if site policy is not accepted.\r\n            return this.currentSite.invalidateWsCache().catch(() => {\r\n                // Ignore errors.\r\n            }).then(() => {\r\n                return this.loginHelper.goToSiteInitialPage();\r\n            });\r\n        }).catch((error) => {\r\n            this.domUtils.showErrorModalDefault(error.message, 'Error accepting site policy.');\r\n        }).finally(() => {\r\n            modal.dismiss();\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/login/pages/site-policy/site-policy.ts"],"sourceRoot":""}
=======
{"version":3,"sources":["../../src/core/login/pages/site/site.module.ts","../../src/core/login/pages/site/site.ts"],"names":[],"mappings":"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","file":"27.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CoreLoginSitePage } from './site';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { CoreDirectivesModule } from '@directives/directives.module';\n\n@NgModule({\n    declarations: [\n        CoreLoginSitePage\n    ],\n    imports: [\n        CoreDirectivesModule,\n        IonicPageModule.forChild(CoreLoginSitePage),\n        TranslateModule.forChild()\n    ]\n})\nexport class CoreLoginSitePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/login/pages/site/site.module.ts","// (C) Copyright 2015 Martin Dougiamas\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, ModalController, NavParams } from 'ionic-angular';\nimport { CoreAppProvider } from '@providers/app';\nimport { CoreSitesProvider } from '@providers/sites';\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\nimport { CoreConfigConstants } from '../../../../configconstants';\nimport { CoreLoginHelperProvider } from '../../providers/helper';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\n\n/**\n * Page to enter or select the site URL to connect to.\n */\n@IonicPage({ segment: 'core-login-site' })\n@Component({\n    selector: 'page-core-login-site',\n    templateUrl: 'site.html',\n})\nexport class CoreLoginSitePage {\n    siteForm: FormGroup;\n    fixedSites: any[];\n    filteredSites: any[];\n    fixedDisplay = 'buttons';\n    showKeyboard = false;\n    filter = '';\n\n    constructor(navParams: NavParams, private navCtrl: NavController, fb: FormBuilder, private appProvider: CoreAppProvider,\n            private sitesProvider: CoreSitesProvider, private loginHelper: CoreLoginHelperProvider,\n            private modalCtrl: ModalController, private domUtils: CoreDomUtilsProvider) {\n\n        this.showKeyboard = !!navParams.get('showKeyboard');\n\n        let url = '';\n\n        // Load fixed sites if they're set.\n        if (this.loginHelper.hasSeveralFixedSites()) {\n            this.fixedSites = <any[]> this.loginHelper.getFixedSites();\n            this.fixedDisplay = CoreConfigConstants.multisitesdisplay;\n            // Autoselect if not defined.\n            if (['list', 'select', 'buttons'].indexOf(this.fixedDisplay) < 0) {\n                this.fixedDisplay = this.fixedSites.length > 8 ? 'list' : (this.fixedSites.length > 3 ? 'select' : 'buttons');\n            }\n            this.filteredSites = this.fixedSites;\n            url = this.fixedSites[0].url;\n        }\n\n        this.siteForm = fb.group({\n            siteUrl: [url, Validators.required]\n        });\n    }\n\n    /**\n     * Try to connect to a site.\n     *\n     * @param {Event} e Event.\n     * @param {string} url The URL to connect to.\n     */\n    connect(e: Event, url: string): void {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.appProvider.closeKeyboard();\n\n        if (!url) {\n            this.domUtils.showErrorModal('core.login.siteurlrequired', true);\n\n            return;\n        }\n\n        if (!this.appProvider.isOnline()) {\n            this.domUtils.showErrorModal('core.networkerrormsg', true);\n\n            return;\n        }\n\n        const modal = this.domUtils.showModalLoading(),\n            siteData = this.sitesProvider.getDemoSiteData(url);\n\n        if (siteData) {\n            // It's a demo site.\n            this.sitesProvider.getUserToken(siteData.url, siteData.username, siteData.password).then((data) => {\n                return this.sitesProvider.newSite(data.siteUrl, data.token, data.privateToken).then(() => {\n                    return this.loginHelper.goToSiteInitialPage();\n                }, (error) => {\n                    this.domUtils.showErrorModal(error);\n                });\n            }, (error) => {\n                this.loginHelper.treatUserTokenError(siteData.url, error, siteData.username, siteData.password);\n            }).finally(() => {\n                modal.dismiss();\n            });\n\n        } else {\n            // Not a demo site.\n            this.sitesProvider.checkSite(url).then((result) => {\n\n                if (result.warning) {\n                    this.domUtils.showErrorModal(result.warning, true, 4000);\n                }\n\n                if (this.loginHelper.isSSOLoginNeeded(result.code)) {\n                    // SSO. User needs to authenticate in a browser.\n                    this.loginHelper.confirmAndOpenBrowserForSSOLogin(\n                        result.siteUrl, result.code, result.service, result.config && result.config.launchurl);\n                } else {\n                    this.navCtrl.push('CoreLoginCredentialsPage', { siteUrl: result.siteUrl, siteConfig: result.config });\n                }\n            }, (error) => {\n                this.showLoginIssue(url, error);\n            }).finally(() => {\n                modal.dismiss();\n            });\n        }\n    }\n\n    /**\n     * The filter has changed.\n     *\n     * @param {any} Received Event.\n     */\n    filterChanged(event: any): void {\n        const newValue = event.target.value && event.target.value.trim().toLowerCase();\n        if (!newValue || !this.fixedSites) {\n            this.filteredSites = this.fixedSites;\n        } else {\n            this.filteredSites = this.fixedSites.filter((site) => {\n                return site.name.toLowerCase().indexOf(newValue) > -1 || site.url.toLowerCase().indexOf(newValue) > -1;\n            });\n        }\n    }\n\n    /**\n     * Show a help modal.\n     */\n    showHelp(): void {\n        const modal = this.modalCtrl.create('CoreLoginSiteHelpPage');\n        modal.present();\n    }\n\n    /**\n     * Show an error that aims people to solve the issue.\n     *\n     * @param {string} url The URL the user was trying to connect to.\n     * @param {string} error Error to display.\n     */\n    protected showLoginIssue(url: string, error: string): void {\n        const modal = this.modalCtrl.create('CoreLoginSiteErrorPage', { siteUrl: url, issue: error });\n        modal.present();\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/login/pages/site/site.ts"],"sourceRoot":""}
>>>>>>> 5632a65c1fdc0002876490b68e6dc6621a0dd43d
